"use strict";function displayUsers(e){$("#list").empty();for(var t=0;t<e.length;t++){$("#list").append("<tr class='user'><th class='id' scope='row'></th><th class='name'></th><th class='last_name'></th><th class='email'></th><th  class='phone'></th><th class='is_closed'></th><th  class='rate'></th></tr>");var s=e[t].id,n=e[t].first_name,a=e[t].last_name,r=e[t].email,p=e[t].phone,i=!1;if(e[t].rates.length>0)for(var o=0;o<e[t].rates.length;o++)if(e[t].rates[o].is_closed){i=!0;break}$("#list tr:last .id").append(s),$("#list tr:last .name").append(n),$("#list tr:last .last_name").append(a),$("#list tr:last .email").append(r),$("#list tr:last .phone").append(p),i?$("#list tr:last .is_closed").append("No"):$("#list tr:last .is_closed").append("Yes"),e[t].rates.length>0?$("#list tr:last .rate").append(' <button id="dialog-opener" type="button" class="btn btn-primary active ui-button ui-corner-all ui-widget " onClick="openRates('+e[t].id+')">Написати</button>'):$("#list tr:last .rate").append('<button type="button" class ="btn .btn-warning disabled">Немає відгуків</button>')}}function getUsers(e){getRates();var t=new XMLHttpRequest;t.open("GET","https://znap.pythonanywhere.com/api/v1.0/web_user/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),users_response=JSON.parse(t.response);var s=users_response.count,n=users_response.results,a=Math.ceil(s/e);document.getElementById("user_table").insertAdjacentHTML("afterend","<div id='buttons'></div");for(var r=1;r<=a;r++){var p="<input type='button' id='id"+r+"'value='"+r+"' onclick='changePage(limit_count,"+r+" )'>";document.getElementById("buttons").insertAdjacentHTML("beforeend",p)}$("#users_count").text(s),displayUsers(n)}function getRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();var t=JSON.parse(e.response);$("#rates_count").text(t.length)}function changeLimit(e){var t=new XMLHttpRequest,s="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e;t.open("GET",s,!1),t.setRequestHeader("Content-Type","application/json"),t.send(),users_response=JSON.parse(t.response);var n=users_response.count;pages_count=Math.ceil(n/e);for(var a=1;a<=pages_count;a++);displayUsers(users_response.results)}function changePage(e,t){var s=new XMLHttpRequest,n=e*(t-1),a="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e+"&offset="+n;s.open("GET",a,!1),s.setRequestHeader("Content-Type","application/json"),s.send(),users_response=JSON.parse(s.response),displayUsers(users_response.results)}function sortUsers(e,t,s,n){var a=new XMLHttpRequest,r=e*(t-1),p="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e+"&offset="+r+"&ordering=";"asc"===n?p+=s:p=p+"-"+s,a.open("GET",p,!1),a.setRequestHeader("Content-Type","application/json"),a.send(),users_response=JSON.parse(a.response),displayUsers(users_response.results)}function getUser(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/user/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getCnap(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getRate(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+znap_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();for(var t=0,s=JSON.parse(e.response),n=0;n<s.length;n++)s[n].quality>0?t++:t--,$("#list2").append('<li class="rates-item" xmlns="http://www.w3.org/1999/html"><div class="row"> <div class="col-md-6"><h4 class="name"></h4><h6 class="description"></h6></div><div class="col-md-6 text-right"><h4 class="quality"></h4></div></div></li>'),$("#list2 li:last .name").append(s[n].first_name+" "+s[n].last_name),$("#list2 li:last .quality").append(s[n].quality),$("#list2 li:last .description").append(s[n].description);var a=t>=0?'<span style="color:green;"> +'+t+"</span>":'<span style="color:red;"> -'+t+"</span>";$(".total-rate").append(a)}function getAdminRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/admin/"+admin_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();JSON.parse(e.response)}function closeRate(e){var t={is_closed:!0},s=new XMLHttpRequest;s.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+e+"/",!1),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(t))}function putAdmin(e,t){var s={admin:e},n=new XMLHttpRequest;n.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+t+"/",!1),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(s))}function openRates(e){for(var t=0;t<users.length;t++)if(users[t].id==e)for(var s=0;s<users[t].rates.length;s++)$("#rates-modal .rates-content").append('<div class="rate-item"><div class="rate-time">'+new Date(users[t].rates[s].timestamp).getDate()+"."+(new Date(users[t].rates[s].timestamp).getMonth()+1)+"."+new Date(users[t].rates[s].timestamp).getFullYear()+'</div><div class="rate-cnap">Cnap name</div><div class="rate-msg">'+users[t].rates[s].description+'</div><div class="btn rate-btn" target="'+users[t].rates[s].id+'">Message</div></div>');$("#wrapper").addClass("blur"),$("#rates-modal").show()}var admin_id=localStorage.getItem("admin_id"),znap_id=localStorage.getItem("znap_id"),users_response,limit_count=10,pages_count;$("#btnApply").click(function(){limit_count=$("#pglmt").val(),changeLimit(limit_count),getUsers()}),$("#rates-modal .close").on("click",function(){$(this).closest("#rates-modal").hide(),$("#wrapper").removeClass("blur"),$("#rates-modal .rates-content").empty()});