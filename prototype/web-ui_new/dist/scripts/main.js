"use strict";function getOpenedChats(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/chat/?is_closed=false&admin_id=",!1),e.setRequestHeader("Content-Type","application/json"),e.send();for(var t=JSON.parse(e.response),n=0;n<t.length;n++){if(""===t[n].last_timestamp){t[n].timestamp}else{t[n].last_timestamp}t[n].last_message,t[n].id}}function displayUsers(e){$("#list").empty();for(var t=0;t<e.length;t++){$("#list").append("<tr class='user'><th class='id' scope='row'></th><th class='name'></th><th class='last_name'></th><th class='email'></th><th  class='phone'></th><th class='is_closed'></th><th  class='rate'></th></tr>");var n=e[t].id,s=e[t].first_name,a=e[t].last_name,r=e[t].email,o=e[t].phone,i=!1;if(e[t].rates.length>0)for(var p=0;p<e[t].rates.length;p++)if(e[t].rates[p].is_closed){i=!0;break}$("#list tr:last .id").append(n),$("#list tr:last .name").append(s),$("#list tr:last .last_name").append(a),$("#list tr:last .email").append(r),$("#list tr:last .phone").append(o),i?$("#list tr:last .is_closed").append("No"):$("#list tr:last .is_closed").append("Yes"),e[t].rates.length>0?$("#list tr:last .rate").append(' <button id="dialog-opener" type="button" class="btn btn-primary active ui-button ui-corner-all ui-widget " onClick="openRates('+e[t].id+')">Написати</button>'):$("#list tr:last .rate").append('<button type="button" class ="btn .btn-warning disabled">Немає відгуків</button>')}}function getUsers(){getRates(),getOpenedChats();var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/web_user/",!1),e.setRequestHeader("Content-Type","application/json"),e.send(),users_response=JSON.parse(e.response);var t=users_response.count,n=users_response.results;pages_count=Math.ceil(t/limit_count),document.getElementById("user_table").insertAdjacentHTML("afterend","<div id='buttons'></div>");var s=1==current?"disabled":"",a=o==pages_count?"disabled":"",r="<input type='button' value='Prev &lt;&lt;' onclick='changePage(limit_count,"+(current-1)+")' "+s+">";document.getElementById("buttons").insertAdjacentHTML("beforeend",r);for(var o=1;o<=pages_count;o++){var i="<input type='button' id='id"+o+"'value='"+o+"' onclick='changePage(limit_count,"+o+" )'>";document.getElementById("buttons").insertAdjacentHTML("beforeend",i)}var p="<input type='button' value='Next &gt;&gt;' onclick='changePage(limit_count,"+(current+1)+")' "+a+">";document.getElementById("buttons").insertAdjacentHTML("beforeend",p),document.getElementById("id1").setAttribute("class","active"),$("#users_count").text(t),displayUsers(n)}function getRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();var t=JSON.parse(e.response);$("#rates_count").text(t.length)}function optionSelected(){limit_count=$("#pglmt").val(),document.getElementById("buttons").innerHTML="",changeLimit(limit_count),document.getElementById("id1").setAttribute("class","active")}function changeLimit(e){var t=new XMLHttpRequest,n="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e;t.open("GET",n,!1),t.setRequestHeader("Content-Type","application/json"),t.send(),users_response=JSON.parse(t.response);var s=users_response.count;pages_count=Math.ceil(s/e);var a=1==current?"disabled":"",r=l==pages_count?"disabled":"",o=current-1,i=current+1,p="<input type='button' value='Prev &lt;&lt;' onclick='changePage(limit_count,"+o+")' "+a+">";document.getElementById("buttons").insertAdjacentHTML("beforeend",p);for(var l=1;l<=pages_count;l++){var c="<input type='button' id='id"+l+"'value='"+l+"' onclick='changePage(limit_count,"+l+" )'>";document.getElementById("buttons").insertAdjacentHTML("beforeend",c)}var d="<input type='button' value='Next &gt;&gt;' onclick='changePage(limit_count,"+i+")' "+r+">";document.getElementById("buttons").insertAdjacentHTML("beforeend",d),displayUsers(users_response.results)}function changePage(e,t){current=t;var n=new XMLHttpRequest,s=e*(t-1),a="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e+"&offset="+s;n.open("GET",a,!1),n.setRequestHeader("Content-Type","application/json"),n.send(),users_response=JSON.parse(n.response);var r=users_response.results,o=1==current?"disabled":"",i=current==pages_count?"disabled":"",p=current-1,l=current+1;document.getElementById("buttons").innerHTML="";var c="<input type='button' value='Prev &lt;&lt;' onclick='changePage(limit_count,"+p+")' "+o+">";document.getElementById("buttons").insertAdjacentHTML("beforeend",c);for(var d=1;d<=pages_count;d++){var u="<input type='button' id='id"+d+"'value='"+d+"' onclick='changePage(limit_count,"+d+" )'>";document.getElementById("buttons").insertAdjacentHTML("beforeend",u)}var m="<input type='button' value='Next &gt;&gt;' onclick='changePage(limit_count,"+l+")' "+i+">";document.getElementById("buttons").insertAdjacentHTML("beforeend",m),document.getElementById("id"+t).setAttribute("class","active"),displayUsers(r)}function sortUsers(e,t,n,s){var a=new XMLHttpRequest,r=e*(t-1),o="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e+"&offset="+r+"&ordering=";"asc"===s?o+=n:o=o+"-"+n,a.open("GET",o,!1),a.setRequestHeader("Content-Type","application/json"),a.send(),users_response=JSON.parse(a.response),displayUsers(users_response.results)}function searchUsers(){var e=document.getElementById("myInput").value,t=new XMLHttpRequest,n="http://znap.pythonanywhere.com/api/v1.0/web_user/?search="+e;t.open("GET",n,!1),t.setRequestHeader("Content-Type","application/json"),t.send(),users_response=JSON.parse(t.response),displayUsers(users_response.results)}function getUser(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/user/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getCnap(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getRate(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+znap_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();for(var t=0,n=JSON.parse(e.response),s=0;s<n.length;s++)n[s].quality>0?t++:t--,$("#list2").append('<li class="rates-item" xmlns="http://www.w3.org/1999/html"><div class="row"> <div class="col-md-6"><h4 class="name"></h4><h6 class="description"></h6></div><div class="col-md-6 text-right"><h4 class="quality"></h4></div></div></li>'),$("#list2 li:last .name").append(n[s].first_name+" "+n[s].last_name),$("#list2 li:last .quality").append(n[s].quality),$("#list2 li:last .description").append(n[s].description);var a=t>=0?'<span style="color:green;"> +'+t+"</span>":'<span style="color:red;"> -'+t+"</span>";$(".total-rate").append(a)}function getAdminRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/admin/"+admin_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();JSON.parse(e.response)}function closeRate(e){var t={is_closed:!0},n=new XMLHttpRequest;n.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+e+"/",!1),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))}function putAdmin(e,t){var n={admin:e},s=new XMLHttpRequest;s.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+t+"/",!1),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(n))}function openRates(e){for(var t=users_response.results,n=0;n<t.length;n++)if(t[n].id==e)for(var s=0;s<t[n].rates.length;s++)$("#rates-modal .rates-content").append('<div class="rate-item"><div class="rate-time">'+new Date(t[n].rates[s].timestamp).getDate()+"."+(new Date(t[n].rates[s].timestamp).getMonth()+1)+"."+new Date(t[n].rates[s].timestamp).getFullYear()+'</div><div class="rate-cnap">Cnap name</div><div class="rate-msg">'+t[n].rates[s].description+'</div><div class="btn rate-btn" target="'+t[n].rates[s].id+'">Message</div></div>');$("#wrapper").addClass("blur"),$("#rates-modal").show()}var admin_id=localStorage.getItem("admin_id"),znap_id=localStorage.getItem("znap_id"),users_response,limit_count=10,pages_count,current=1;$("#rates-modal .close").on("click",function(){$(this).closest("#rates-modal").hide(),$("#wrapper").removeClass("blur"),$("#rates-modal .rates-content").empty()});