"use strict";function getUsers(){getRates();var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/web_user/",!1),e.setRequestHeader("Content-Type","application/json"),e.send(),users_response=JSON.parse(e.response);for(var t=users_response.count,s=users_response.results,a=0;a<s.length;a++){$("#list").append("<tr class='user'><th class='id' scope='row'></th><th class='name'></th><th class='last_name'></th><th class='email'></th><th  class='phone'></th><th class='is_closed'></th><th  class='rate'></th></tr>");var n=s[a].id,p=s[a].first_name,r=s[a].last_name,i=s[a].email,o=s[a].phone,l=!1;if(s[a].rates.length>0)for(var d=0;d<s[a].rates.length;d++)if(s[a].rates[d].is_closed){l=!0;break}$("#list tr:last .id").append(n),$("#list tr:last .name").append(p),$("#list tr:last .last_name").append(r),$("#list tr:last .email").append(i),$("#list tr:last .phone").append(o),l?$("#list tr:last .is_closed").append("No"):$("#list tr:last .is_closed").append("Yes"),s[a].rates.length>0?$("#list tr:last .rate").append(' <button id="dialog-opener" type="button" class="btn btn-primary active ui-button ui-corner-all ui-widget " onClick="openRates('+s[a].id+')">Написати</button>'):$("#list tr:last .rate").append('<button type="button" class ="btn .btn-warning disabled">Немає відгуків</button>')}$("#users_count").text(t)}function getRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();var t=JSON.parse(e.response);$("#rates_count").text(t.length)}function getUser(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/user/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getCnap(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getRate(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+znap_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();for(var t=0,s=JSON.parse(e.response),a=0;a<s.length;a++)s[a].quality>0?t++:t--,$("#list2").append('<li class="rates-item" xmlns="http://www.w3.org/1999/html"><div class="row"> <div class="col-md-6"><h4 class="name"></h4><h6 class="description"></h6></div><div class="col-md-6 text-right"><h4 class="quality"></h4></div></div></li>'),$("#list2 li:last .name").append(s[a].first_name+" "+s[a].last_name),$("#list2 li:last .quality").append(s[a].quality),$("#list2 li:last .description").append(s[a].description);var n=t>=0?'<span style="color:green;"> +'+t+"</span>":'<span style="color:red;"> -'+t+"</span>";$(".total-rate").append(n)}function getAdminRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/admin/"+admin_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();JSON.parse(e.response)}function closeRate(e){var t={is_closed:!0},s=new XMLHttpRequest;s.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+e+"/",!1),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(t))}function putAdmin(e,t){var s={admin:e},a=new XMLHttpRequest;a.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+t+"/",!1),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(s))}function openRates(e){for(var t=0;t<users.length;t++)if(users[t].id==e)for(var s=0;s<users[t].rates.length;s++)$("#rates-modal .rates-content").append('<div class="rate-item"><div class="rate-time">'+new Date(users[t].rates[s].timestamp).getDate()+"."+(new Date(users[t].rates[s].timestamp).getMonth()+1)+"."+new Date(users[t].rates[s].timestamp).getFullYear()+'</div><div class="rate-cnap">Cnap name</div><div class="rate-msg">'+users[t].rates[s].description+'</div><div class="btn rate-btn" target="'+users[t].rates[s].id+'">Message</div></div>');$("#wrapper").addClass("blur"),$("#rates-modal").show()}var admin_id=localStorage.getItem("admin_id"),znap_id=localStorage.getItem("znap_id"),users_response;$("#rates-modal .close").on("click",function(){$(this).closest("#rates-modal").hide(),$("#wrapper").removeClass("blur"),$("#rates-modal .rates-content").empty()});