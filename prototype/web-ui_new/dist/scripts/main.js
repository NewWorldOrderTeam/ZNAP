"use strict";function displayUsers(e){$("#list").empty();for(var t=0;t<e.length;t++){$("#list").append("<tr class='user'><th class='id' scope='row'></th><th class='name'></th><th class='last_name'></th><th class='email'></th><th  class='phone'></th><th class='is_closed'></th><th  class='rate'></th></tr>");var s=e[t].id,n=e[t].first_name,a=e[t].last_name,r=e[t].email,i=e[t].phone,p=!1;if(e[t].rates.length>0)for(var o=0;o<e[t].rates.length;o++)if(e[t].rates[o].is_closed){p=!0;break}$("#list tr:last .id").append(s),$("#list tr:last .name").append(n),$("#list tr:last .last_name").append(a),$("#list tr:last .email").append(r),$("#list tr:last .phone").append(i),p?$("#list tr:last .is_closed").append("No"):$("#list tr:last .is_closed").append("Yes"),e[t].rates.length>0?$("#list tr:last .rate").append(' <button id="dialog-opener" type="button" class="btn btn-primary active ui-button ui-corner-all ui-widget " onClick="openRates('+e[t].id+')">Написати</button>'):$("#list tr:last .rate").append('<button type="button" class ="btn .btn-warning disabled">Немає відгуків</button>')}}function getUsers(){getRates();var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/web_user/",!1),e.setRequestHeader("Content-Type","application/json"),e.send(),users_response=JSON.parse(e.response);var t=users_response.count,s=users_response.results;pages_count=Math.ceil(t/limit_count),document.getElementById("user_table").insertAdjacentHTML("afterend","<div id='buttons'></div");var n=a==pages_count?"disabled":"";document.getElementById("buttons").insertAdjacentHTML("beforeend","<input type='button' value='&lt;&lt; Prev'  disabled>");for(var a=1;a<=pages_count;a++){var r="<input type='button' id='id"+a+"'value='"+a+"' onclick='changePage(limit_count,"+a+" )'>";document.getElementById("buttons").insertAdjacentHTML("beforeend",r)}var i="<input type='button' value='Next &gt;&gt;' onclick='changePage(limit_count,2)' "+n+">";document.getElementById("buttons").insertAdjacentHTML("beforeend",i),document.getElementById("id1").setAttribute("class","active"),$("#users_count").text(t),displayUsers(s)}function getRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();var t=JSON.parse(e.response);$("#rates_count").text(t.length)}function changeLimit(e){var t=new XMLHttpRequest,s="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e;t.open("GET",s,!1),t.setRequestHeader("Content-Type","application/json"),t.send(),users_response=JSON.parse(t.response);var n=users_response.count;pages_count=Math.ceil(n/e);for(var a=1;a<=pages_count;a++){var r="<input type='button' id='id"+a+"'value='"+a+"' onclick='changePage(limit_count,"+a+" )'>";document.getElementById("buttons").insertAdjacentHTML("beforeend",r)}displayUsers(users_response.results)}function changePage(e,t){var s=new XMLHttpRequest,n=e*(t-1),a="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e+"&offset="+n;s.open("GET",a,!1),s.setRequestHeader("Content-Type","application/json"),s.send(),users_response=JSON.parse(s.response);for(var r=users_response.results,i=1;i<=pages_count;i++)document.getElementById("id"+i).setAttribute("class","unactive");document.getElementById("id"+t).setAttribute("class","active"),displayUsers(r)}function sortUsers(e,t,s,n){var a=new XMLHttpRequest,r=e*(t-1),i="https://znap.pythonanywhere.com/api/v1.0/web_user/?limit="+e+"&offset="+r+"&ordering=";"asc"===n?i+=s:i=i+"-"+s,a.open("GET",i,!1),a.setRequestHeader("Content-Type","application/json"),a.send(),users_response=JSON.parse(a.response),displayUsers(users_response.results)}function getUser(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/user/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getCnap(e){var t=new XMLHttpRequest;return t.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+e+"/",!1),t.setRequestHeader("Content-Type","application/json"),t.send(),JSON.parse(t.response)}function getRate(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/znap/"+znap_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();for(var t=0,s=JSON.parse(e.response),n=0;n<s.length;n++)s[n].quality>0?t++:t--,$("#list2").append('<li class="rates-item" xmlns="http://www.w3.org/1999/html"><div class="row"> <div class="col-md-6"><h4 class="name"></h4><h6 class="description"></h6></div><div class="col-md-6 text-right"><h4 class="quality"></h4></div></div></li>'),$("#list2 li:last .name").append(s[n].first_name+" "+s[n].last_name),$("#list2 li:last .quality").append(s[n].quality),$("#list2 li:last .description").append(s[n].description);var a=t>=0?'<span style="color:green;"> +'+t+"</span>":'<span style="color:red;"> -'+t+"</span>";$(".total-rate").append(a)}function getAdminRates(){var e=new XMLHttpRequest;e.open("GET","https://znap.pythonanywhere.com/api/v1.0/admin/"+admin_id+"/rate/",!1),e.setRequestHeader("Content-Type","application/json"),e.send();JSON.parse(e.response)}function closeRate(e){var t={is_closed:!0},s=new XMLHttpRequest;s.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+e+"/",!1),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(t))}function putAdmin(e,t){var s={admin:e},n=new XMLHttpRequest;n.open("PUT","https://znap.pythonanywhere.com/api/v1.0/rate/"+t+"/",!1),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(s))}function openRates(e){for(var t=users_response.results,s=0;s<t.length;s++)if(t[s].id==e)for(var n=0;n<t[s].rates.length;n++)$("#rates-modal .rates-content").append('<div class="rate-item"><div class="rate-time">'+new Date(t[s].rates[n].timestamp).getDate()+"."+(new Date(t[s].rates[n].timestamp).getMonth()+1)+"."+new Date(t[s].rates[n].timestamp).getFullYear()+'</div><div class="rate-cnap">Cnap name</div><div class="rate-msg">'+t[s].rates[n].description+'</div><div class="btn rate-btn" target="'+t[s].rates[n].id+'">Message</div></div>');$("#wrapper").addClass("blur"),$("#rates-modal").show()}var admin_id=localStorage.getItem("admin_id"),znap_id=localStorage.getItem("znap_id"),users_response,limit_count=10,pages_count;$("#btnApply").click(function(){limit_count=$("#pglmt").val(),document.getElementById("buttons").innerHTML="",changeLimit(limit_count),document.getElementById("id1").setAttribute("class","active")}),$("#rates-modal .close").on("click",function(){$(this).closest("#rates-modal").hide(),$("#wrapper").removeClass("blur"),$("#rates-modal .rates-content").empty()});